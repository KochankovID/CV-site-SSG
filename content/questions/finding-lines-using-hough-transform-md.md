---
filename: " finding-lines-using-Hough-transform.md"
title: Поиск линий с помощью преобразования Хафа.
Summary: Преобразование Хафа — это метод для поиска линий, кругов и других
  простых форм на изображении.
date: 2022-01-07T16:09:53.851Z
билеты: Билет 9
draft: false
weight: 8
author: Sergey Kryukov
cover:
  image: https://learnopencv.com/wp-content/uploads/2019/03/line-detection.jpg
---
Преобразование Хафа — это метод обнаружения прямых и кривых линий на полутоновых или цветных изображениях. Метод позволяет указать параметры семейства кривых и обеспечивает поиск на изображении множества кривых заданного семейства. 

## Реализация алгоритма Хафа

### Краткое описание

Алгоритм преобразования Хафа использует массив, называемый *аккумулятором*, для определения присутствия *на плоскости* прямой  выраженной уравнением
\( R = x*cos(f)+y*sin(f) \), где\
R – длина перпендикуляра опущенного на прямую из начала координат,\
f — угол между перпендикуляром к прямой и осью OX.\
f находится в пределах от 0 до 2*PI,\
R ограничено размерами входного изображения.) . 

Размерность аккумулятора равна количеству неизвестных параметров пространства Хафа. Например, для линейной трансформации нужно использовать двумерный массив, так как имеются два неизвестных : R и f. Два измерения аккумулятора соответствуют квантованным значениям   R (расстояния) и f (угла).   

 Для каждой точки и её соседей алгоритм определяет, достаточен ли вес границы в этой точке. Если да, то алгоритм вычисляет параметры прямой и увеличивает значение в ячейке аккумулятора, соответствующей данным параметрам.

Получаем сетку на пространстве (R, f), одной ячейке которой соответствует набор прямых с близкими значениями R и f.

### Код с объяснением

Процедура accumulate_lines представляет собой версию преобразования Хафа. 

**ИСПРАВИТЬ 7 СТРОКУ С КОНЦА** на "D:= abs(C\*cos(THETAQ) + R\*sin(THETAQ));"      минус меняем на плюс

{{< figure src="/images/uploads/find_line.jpg"
class="figure__image" >}}

Элемент PTLIST\[M,B] содержит список координат всех пикселов, которые внесли вклад в значение аккумуляторного массива A\[M,B]. 

Функция row_gradient и column_gradiet обрабатывают окрестности пикселов для оценки компонент градиента в направлении строк и столбцов.                                                                                                Функция gradient комбинирует комбинирует две эти компоненты для получения величины градиента.

 if GMAG > gradient*threshold определяем, достаточен ли вес границы в этой точке.

Функция atan2 возвращает по заданным компонентам градиента угол в соответствующем квадранте. 

D - это длина перпендикуляра к прямой

PTLIST - массив списков \[длина соответствующего перпендикуляра,  его угол с осью абсцисс], в который включены все подходящие линии.