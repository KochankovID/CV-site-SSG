---
filename: "image-filtration.md"
title: Фильтрация изображений
Summary: >
  Под фильтрацией̆ изображений понимают операцию, имеющую своим результатом изображение того же размера, полученное 
  из исходного по некоторым правилам (фильтрам).
date: 2022-01-08T10:39:14+03:00
билеты: ["Билет 4", ]
draft: false
weight: 8
cover:
  image: https://sites.google.com/site/rexstribeofimageprocessing/_/rsrc/1227563091139/traditional-image-processing/course-work-8-filtering-and-edge-detection-of-image/12.jpg
author: "Ilya Kochankov"
---

## Что такое фильтрация изображений?

Под **фильтрацией изображений** понимают операцию, имеющую своим результатом изображение того же размера, 
полученное из исходного по некоторым правилам (фильтрам). Обычно цвет каждого пикселя результирующего изображения 
обусловлена цветами пикселей, расположенных в некоторой его окрестности в исходном изображении.

{{< figure src="https://vscode.ru/wp-content/uploads/2015/04/theconvolutionkernel.png"
class="figure__image" >}}

---

## Линейные фильтры

### Определение линейных фильтров

Пусть задано исходное полутоновое изображение A, и обозначим интенсивности его пикселей \\( A(x, y) \\). 
Линейный фильтр определяется вещественнозначной функцией \\( F \\), заданной на растре. Данная функция называется ядром фильтра,
а сама фильтрация производится при помощи операции дискретной свертки (взвешенного суммирования):

\\( B(x, y) = \sum_i \sum_j F(i,j) * A(x + i, y + j) \\)

{{< figure src="/images/uploads/linear-filtration.png"
class="figure__image" >}}

### Примеры линейных фильтров

#### Сглаживающие фильтры

Сглаживающие фильтры действуют на изображение аналогично мутному стеклу: изображение становится
нерезким, размытым.

Простейший прямоугольный сглаживающий фильтр радиуса \\( r\\) задается при помощи матрицы размера \\( (2r + 1) × (2r + 1) \\), 
все значения которой равны \\(\frac{1}{(2r+1)^2} \\)

{{< figure src="https://miro.medium.com/max/1400/1*ExWYZTbJ7f6p6pvdg8RkWA.png"
class="figure__image" >}}

> Cумма по всем элементам матрицы равна, таким образом, единице. При фильтрации с данным ядром значение пикселя
> заменяется на усредненное значение пикселей в квадрате со стороной 2r+1 вокруг него

#### Фильтр Гауса

Ядро фильтра: 
\\( G_\sigma = \frac{1}{2\pi\sigma^2} e^{-\frac{(x^2 + y^2)}{2\sigma^2}} \\)

\\( \sigma^2 \\) - дисперсия случайной величины

> Дисперсия — мера разброса данной случайной величины, то
есть её отклонения от математического ожидания.

> Гауссовский фильтр имеет ненулевое ядро бесконечного размера. Однако ядро фильтра очень быстро убывает к нулю при 
> удалении от точки (0, 0), и потому на практике можно ограничиться сверткой с окном небольшого размера.

{{< figure src="/images/uploads/gaussian-filter.png"
class="figure__image" >}}

{{< figure src="https://www.mathworks.com/help/examples/images/win64/SmoothImageWithGaussianFiltersExample_01.png"
class="figure__image" >}}

#### Контрастоповышающие фильтры

Ядро контрастоповышающего фильтра имеет значение, большее 1, в точке (0, 0), при общей сумме всех значений, равной 1.

{{< figure src="/images/uploads/contrast-enhancing.png"
class="figure__image" >}}

{{< figure src="https://avatars.mds.yandex.net/get-zen_doc/176438/pub_5c6422c1e3c7ad00ae588bb8_5c642359c0874300adc6b936/scale_1200"
class="figure__image" >}}

> Характерным артефактом линейной контрастоповышающей фильтрации являются заметные светлые и менее заметные темные 
> ореолы вокруг границ.

#### Разностные фильтры (фильтры находящие границы)

В отличие от сглаживающих и контрастоповышающих фильтров, не меняющих среднюю интенсивность изображения 
(сумма элементов ядра равна единице), в результате применения **разностных фильтров** получается, как правило, 
изображение со средним значением пикселя близким к нулю. 

Вертикальным перепадам (границам) исходного изображения соответствуют пиксели с большими по модулю значениями на
результирующем изображении. Поэтому разностные фильтры называют также фильтрами, **находящими границы**.

##### Фильтры Прюита и Собеля

{{< figure src="/images/uploads/prewitt-sobel-filter.png"
class="figure__image" >}}

{{< figure src="/images/uploads/prewitt-sobel-preview.png"
class="figure__image" >}}

> Недостатки: неопределенность в выборе величины порога. Для разных частей изображения приемлемый результат обычно 
> получается при существенно разных пороговых значениях. Кроме того, разностные фильтры очень чувствительны к шумам изображения.

##### Фильтр Лапласа

Фильтр используется для подсветки (выделения) границ и повышения резкости. Его применение подчеркивает разрывы 
уровней яркостей на изображении и подавляет области со слабыми изменениями яркостей.

Ядро фильтра:

{{< figure src="/images/uploads/laplas-filter.png"
class="figure__image" >}}

{{< figure src="https://878212.smushcdn.com/1966598/wp-content/uploads/2021/03/OpenCV_21_2-1024x453.jpg?lossy=1&strip=1&webp=1"
class="figure__image" >}}

---

## Нелинейные фильтры

### Определение нелинейных фильтров

Нелинейными называются фильтры, которые используют нелинейные функции.

### Примеры нелинейных фильтров
#### Пороговый фильтр
Одним из примеров нелинейного фильтра является [пороговая фильтрация](/questions/halftones-binarization). Результатом пороговой фильтрации служит [бинарное 
изображение](/questions/binary-images), определяемое следующим образом:

{{< figure src="/images/uploads/threshold-filter.png"
class="figure__image" >}}

{{< figure src="http://4.bp.blogspot.com/_Eiwce13X738/TO1DQYhndxI/AAAAAAAAJBg/CLVyzWkyVpo/s1600/Posterize.jpg"
class="figure__image" >}}

#### Медианный фильтр
Алгоритм работы:
1. Как и в линейных фильтрах, по пикселям передвигается окно, которое охватывает пиксели,
участвующие в формировании итоговой интенсивности.

2. Значения внутри этого окна воспринимается как одномерный массив, который сортируется в
порядке возрастания.

3. Значение, находящееся в середине отсортированного массива, поступает на выход фильтра.

Пример применения фильтра размытия (б) и медианного фильтра (в):

{{< figure src="/images/uploads/median-filter-preview.png"
class="figure__image" >}}

> Медианный фильтр работает медленнее чем фильтр Гауса, но лучше сохраняет границы.

#### Билатеральный фильтр

Билатеральный фильтр является нелинейным сглаживающим фильтром. Значение каждого пикселя изображения заменяется
взвешенным средним соседних пикселей. Веса могут определяться, например, распределением Гаусса. 

Но, веса в билатеральном фильтре также зависят и от радиометрических 
показателей (таких, например, как разница в цвете или яркости рассматриваемых пикселей).

Билатеральный фильтр определяется следующим выражением:

\\( I^{filtered}(x) = \sum_{x_i \in \Omega} I(x_i)f_r(|| I(x_i) - I(x)||)g_s(|| x_i - x||) \\), где

\\( I^{filtered} \\) - результирующее изображение

\\( I \\) - исходное изображение

\\( x \\) - координаты пикселя, в котором вычисляется выражение

\\( \Omega \\) - окно с центром в \\( x \\)

\\( f_r \\) - ядро, сглаживающее разницу в интенсивности цветов; может определяться функцией Гауса

\\( g_r \\) - ядро, сглаживающее разницу в расстоянии между пикселями; может определяться функцией Гауса

|| || - операция нормализации


{{< figure src="https://www.researchgate.net/profile/Fatih-Porikli/publication/221361504/figure/fig4/AS:305607526633475@1449873920200/PSNR-accuracy-of-the-presented-O-1-bilateral-filter-with-box-spatial-given-in-Eq-4.png"
class="figure__image" >}}
