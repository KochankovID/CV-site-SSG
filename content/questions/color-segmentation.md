---
filename: color-segmentation.md
title: Цветовая сегментация
Summary: >
  В задаче поиска объектов, классификации сцены или сравнения изображений часто необходимо разбить
  изображение на непересекающиеся регионы, содержащие близкие по цвету пикселы.
date: 2022-01-09T22:12:12+03:00
билеты: ["Билет 8", ]
draft: false
weight: 16
cover:
  image: https://www.machinelearningmastery.ru/img/0-248594-222128.png
author: "Ilya Kochankov"
---

## Зачем нужна цветовая сегментация?

В задаче поиска объектов, классификации сцены или сравнения изображений часто необходимо разбить
изображение на непересекающиеся регионы, содержащие близкие по цвету пикселы.

Цветовая сегментация фото или видео дает возможность выделить объект с конкретным оттенком, а уже затем обработать его, 
например распознать движется он или нет (или к примеру удалить фон с изображения).

{{< figure src="https://neurohive.io/wp-content/uploads/2019/04/semantic-segmentation-guide-e1554246275740.jpg" class="figure__image" >}}

## k-средних
### Определение метода k-средних

Алгоритм **k-средних** - один из алгоритмов машинного обучения, решающий задачу кластеризации. 
Этот алгоритм получил большую популярность благодаря своей простоте, наглядности реализации и достаточно высокому качеству работы.

Алгоритм разбивает множество элементов векторного пространства на заранее известное число кластеров k. 
Действие алгоритма таково, что он стремится минимизировать среднеквадратичное отклонение на точках каждого кластера. 

Алгоритм завершается, когда на какой-то итерации не происходит изменения кластеров. 

### Пошаговый алгоритм

1. Выбирается число кластеров k.
2. Из исходного множества данных случайным образом выбираются k наблюдений, которые будут служить начальными центрами кластеров.
3. Для каждого наблюдения исходного множества определяется ближайший к нему центр кластера (расстояния измеряются в метрике Евклида). 
При этом записи, «притянутые» определенным центром, образуют начальные кластеры.
4. Вычисляются центроиды — центры тяжести кластеров. Каждый центроид — это вектор, элементы которого представляют собой 
средние значения соответствующих признаков, вычисленные по всем записям кластера.
5. Центр кластера смещается в его центроид, после чего центроид становится центром нового кластера.
6. 3-й и 4-й шаги итеративно повторяются. 
Очевидно, что на каждой итерации происходит изменение границ кластеров и смещение их центров. 
В результате минимизируется расстояние между элементами внутри кластеров и увеличиваются междукластерные расстояния.

### Пример работы алгоритма

1. Мы случайным образом выбираем начальные точки:

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/K_Means_Example_Step_1.svg/300px-K_Means_Example_Step_1.svg.png" 
class="figure__image" >}}

2. Точки, отнесённые к начальным центрам. Разбиение на плоскости — диаграмма Вороного относительно начальных центров:

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/K_Means_Example_Step_2.svg/300px-K_Means_Example_Step_2.svg.png"
class="figure__image" >}}

3. Вычисление новых центров кластеров (ищется центр масс):

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/K_Means_Example_Step_3.svg/300px-K_Means_Example_Step_3.svg.png"
class="figure__image" >}}

4. Предыдущие шаги, за исключением первого, повторяются, пока алгоритм не сойдётся:

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/K_Means_Example_Step_4.svg/300px-K_Means_Example_Step_4.svg.png"
class="figure__image" >}}

## Цветовая сегментация методом k-средних
### Применение k-средних в цветовой сегментации

1) Выбираем ожидаемое число цветных объектов K.
2) Все пикселы рассматриваем как точки в трехмерном RGB пространстве.
3) Среди этих точек ищутся K кластеров методом K-средних.
4) Пикселы изображения сравниваются с найденными центрами кластеров и принадлежат сегменту ассоциированному с ближайшему по цвету кластеру.

> Эту сегментацию лучше делать в [LAB](https://ru.wikipedia.org/wiki/LAB) пространстве

### Пример применение k-средних в цветовой сегментации

{{< figure src="https://www.mathworks.com/matlabcentral/mlc-downloads/downloads/44c74a6b-d53a-47f4-833a-963c90f213c5/f8751a06-17a9-402f-ab9e-5dae00946aa7/images/screenshot.png"
class="figure__image" >}}

> Может использоваться для сжатия изображений.
