---
title: "Связанные компоненты"
Summary: "В основе многих сложных процедур анализа изображения лежит выделение связных областей или связных контуров,
выполняемое на первом этапе анализа изображения. Связная область изображения это, с одной стороны, 
тип объекта, все еще очень близко связанный с растровым изображением"
date: 2022-01-06T19:09:48+03:00
билеты: ["Билет 2", ]
draft: false
weight: 4
cover:
  image: https://neerc.ifmo.ru/wiki/images/thumb/0/0f/Components1.png/800px-Components1.png
author: "Ilya Kochankov"
---

## Что такое связанная область?

В основе многих сложных процедур анализа изображения лежит выделение связных областей или связных контуров, 
выполняемое на первом этапе анализа изображения.

**Связной областью** изображения считается такая его область (множество точек), в которой:

1. все точки области имеют одинаковое значение (яркости или любого другого рассматриваемого признака)
2. между любыми двумя точками, принадлежащими данной области, существует непрерывный путь, состоящий из точек, также
   принадлежащих данной области и являющихся при этом "соседями" в смысле заданного отношения соседства (8- или 4- связности).

В случае анализа бинарного изображения первое условие означает, что рассматриваются отдельные связные области, из 
которых состоит "объект" или "фон".

---

## Свойства областей бинарного изображения

- Геометрические (площадь, центр тяжести, периметр, экстремальные точки)

{{< figure src="/images/uploads/square.png"
class="figure__image" >}}

{{< figure src="/images/uploads/center_of_gravity.png"
class="figure__image" >}}

{{< figure src="/images/uploads/perimeter.png"
class="figure__image" >}}

- Свойства формы (характеристики округлости и продолговатости)

{{< figure src="/images/uploads/circle.png"
class="figure__image" >}}

{{< figure src="/images/uploads/harlick_circle.png"
class="figure__image" >}}

{{< figure src="/images/uploads/describing_rectangle.png"
class="figure__image" >}}

{{< figure src="/images/uploads/center_moment.png"
class="figure__image" >}}

- Свойства интенсивности (средняя, текстурные статистики)

> Их можно получить накладывая бинарную область как маску на исходное изображение

---

## Выделение связных областей на бинарных изображениях
### Соседство и связность на цифровых изображениях
Понятия "соседства" и "связности" тесно связаны с естественной топологией и геометрией дискретного цифрового изображения.
Как мы уже отмечали ранее, каждый пиксел изображения с координатами \\((x, y)\\) имеет восемь соседей, то есть примыкающих 
к нему ближайших пикселов, составляющих прямоугольную окрестность 3×3

При этом четыре пиксела (соседи по горизонтали и вертикали) являются более близкими соседями и находятся от 
центрального пиксела окрестности на расстоянии 1. Еще четыре пиксела (соседи по диагонали) являются менее близкими 
соседями и находятся от центрального пиксела окрестности на расстоянии \\( \sqrt{2} \\). Соответственно, в обработке изображений 
рассматриваются два вида соседства и два соответствующих им вида связности:

1. соседство "по кресту" и 4-связность
2. соседство "по квадрату" и 8-связность

{{< figure src="/images/uploads/connected-components.png"
class="figure__image" >}}

Чаще используется отношение 8-связности, при котором считается, что на прямоугольной решетке каждая точка изображения 
имеет восемь соседей.

---

## Рекурсивный алгоритм выделения связанных компонент

```python
import numpy as np


def labeling(image: np.ndarray) -> np.ndarray:
    labels = np.empty_like(image)
    label_number = 1
    for y in image.shape[0]:
        for x in image.shape[1]:
            search_label(image, labels, y, x, label_number)
            label_number += 1
    return labels


def search_label(
    image: np.ndarray, labels: np.ndarray, y: int, x: int, label_number: int
):
    if labels[y][x] == 0 and image[y][x] == 1:
        labels[y][x] = label_number
        if x > 0:
            search_label(image, labels, x - 1, y, label_number)
        if x < image.shape[1] - 1:
            search_label(image, labels, x + 1, y, label_number)
        if y > 0:
            search_label(image, labels, x, y - 1, label_number)
        if y < image.shape[0] - 1:
            search_label(image, labels, x, y + 1, label_number)
```
