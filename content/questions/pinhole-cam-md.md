---
filename: pinhole-cam.md
title: Модель pinhole camera (камера Обскура)
Summary: Моделью pinhole camera является модель-обскура, которая описывает
  математическую зависимость проекции точек в трехмерном пространстве на
  плоскость изображения.
date: 2022-01-08T18:28:40.271Z
билеты: Билет 15
draft: false
weight: 15
author: Sergey Kryukov
cover:
  image: https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Pinhole-camera.svg/400px-Pinhole-camera.svg.png
---
## Что такое модель pinhole camera?

Моделью **pinhole camera** является модель-обскура, которая описывает математическую зависимость проекции точек в 
трехмерном пространстве на плоскость изображения. 

Камера представляет собой просто коробку с маленькой дырочкой на одной стороне и фотопленкой, лежащей на другой.

Изображения, полученные с помощью пинхол-камер, воспроизвести гораздо проще (и дешевле), чем изображения, 
полученные с помощью более сложных камер, и по этой причине пинхол-камера на самом деле является моделью, 
используемой в большинстве (если не во всех) 3D-приложениях и видеоиграх.

Чтобы получить четкое изображение, нам нужно сделать апертуру (отверстие) камеры-обскуры как можно меньше (но не менее 1мм, 
иначе маленькое отверстие не даст достаточно цвета для четкой картинки и она будет плохо различима), 
чтобы гарантировать, что только узкий пучок фотонов, идущих с одного направления, входит в камеру и 
попадает на пленку или датчик в одной точке. 

Если отверстие будет большим, то изображение станет размытым.

{{< figure src="https://www.scratchapixel.com/images/upload/cameras/pinhole2.gif?"
class="figure__image" >}}

## Свойства камеры

{{< figure src="/images/uploads/pinhole-camera-effects.png" class="figure__image" >}}

- Размер проекции объекта обратно пропорционален расстоянию до него.
- Точка проектируется в точку.
- Линия проектируется в линию.
- Углы не сохраняются.
- Параллельные линии могут пересекаться (на мнимом изображении).


## Внутренние параметры камеры

{{< figure src="https://upload.wikimedia.org/wikipedia/en/thumb/7/7c/Pinhole.svg/800px-Pinhole.svg.png" 
class="figure__image" >}}

- Трехмерная система координат \\( (X_1, X_2, X_3) \\) с началом в точке **O**. Эту точку так же называют "апертурой" камеры.
Ось \\( X_3 \\) указывает в направление смотрящего и называется оптической осью, главной осью или главным лучём. Плоскость,
образованная осями \\( X_1, X_2\\) на переднем плане камеры называется главной плоскостью.
- Плоскость изображения, на которую попадает проекция трехмерного мира через апертуру камеры. Плоскость изображения паралельна
осям \\( X_1, X_2\\) и находится на расстоянии **\\( f \\)** от точки начала координат **O** в отрицательном направлении 
по оси \\( X_3 \\). Расстояние **\\( f \\)** называется фокусным расстоянием. 

  > На практике фокусное расстояние f всегда больше нуля
по модулю.

- Точка **R** находится на пересечении оптической оси и плоскости изображения. Эта точка называется главной точкой или центром изображения.
- Точка **P** находится в пространстве мировых координат \\( (x_1, x_2, x_3) \\).
- Зеленая линия, проходящая через точку **P** и апертуру камеры называется линией проекции точки **P**.
- Проекция точки **P** на плоскость изображения обозначается **Q**.
- В плоскости изображения существует двухмерная система координат \\( (Y_1, Y_2) \\). Координаты точки **Q** относительно 
этой системы координат \\( (y_1, y_2) \\).

> Апертура камеры Обскура, через которую должны проходить все проекционные линии, предполагается бесконечно малой точкой.

>В литературе эта точка в трехмерном пространстве называется оптическим (или линзовым, или камерным) центром.

## Перевод координат

Определим как зависят координаты \\( (y_1, y_2) \\) точки **Q** от координат \\( (x_1, x_2, x_3) \\) точки **P**.

Для этого рассмотрим график, который показывает предыдущую сцену, но в упрощенном двухмерном виде (смотря сверху вниз, в отрицательном
направлении оси \\( X_2\\))

{{< figure src="https://upload.wikimedia.org/wikipedia/en/thumb/f/f8/Pinhole2.svg/800px-Pinhole2.svg.png"
class="figure__image" >}}

На этом рисунке мы видим два подобных треугольника, оба из которых имеют части проекционной линии 
(зеленые) в качестве гипотенуз. Катеты левого треугольника \\( -y_1 \\) и \\( f \\), а катеты правого треугольника
\\( x_1 \\) и \\( x_2 \\).

Так как эти треугольники подобны, то \\( \frac{-y_1}{f} = \frac{x_1}{x_3} \\) или \\( y_1 = -\frac{fx_1}{x_3} \\)

Если повторить наблюдения, но теперь не сверху вниз, а с боку (в отрицательном направлении оси \\( X_1 \\) ) то получим
схожие формулы: \\( \frac{-y_2}{f} = \frac{x_2}{x_3} \\) или \\( y_2 = -\frac{fx_2}{x_3} \\)

Суммируя, получаем формулу перехода:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/70c79e0e98a904817a98219ca239edab07625c90"
class="figure__image" >}}

> Координаты точки **Q** не зависят от координат \\( (x_1^0, x_2^0, x_3^0) \\) точки **O**.

## Модель дисторсии камеры
### Что такое дисторсия?

**Дисторсия -** это погрешность изображения в оптической системе (когда используются линзы) при которой коэфицент линейного увеличения изменяется 
по мере удаления отображаемых предметов от оптической оси. 

При этом нарушается геометрическое подобие между объектом и его изображением. 
Она обусловлена тем фактом, что фокусное расстояние в разных частях линзы отличается.

При дисторсии не нарушается резкость изображения, но искажается его форма.

### Примеры дисторсии

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Lens_distorsion.svg/1200px-Lens_distorsion.svg.png"
class="figure__image" >}}

### Математическое описание дисторсии

Модель описывает переход от неискаженного изображения к изображению с дисторсией
следующими преобразованиями координат \\( (x_u, y_u) \\) точки на неискаженном изображении:

\\(\begin{cases} x_d=x_u(1+k_1r^2+k_2r^4+ ...) + (p_2(r^2+2x^2_u)+2p_1x_uy_u)(1 + p_3r^2+p_4r^4+...) \\\\ y_d = y_u(1+k_1r^2+k_2r^4+ ...) + (p_1(r^2+2x^2_u)+2p_2x_uy_u)(1 + p_3r^2+p_4r^4+...) \end{cases} \\)

\\( (x_d, y_d) \\) – координаты точки \\( (x_u, y_u) \\) на искажённом дисторсией изображении

\\( r= \sqrt{(x_u - c_x)^2 + (y_u - c_y)^2} \\) - расстояние от оптического центра \\( (c_x, c_y) \\) до точки
\\( (x_u, y_u) \\)

\\( k_i \\) - коэффициенты радиальной дисторсии

\\( p_i \\) - коэффициенты тангенциальной дисторсии

> В практических задачах, коэффициенты тангенциальной дисторсии рассматриваются до коэффициента \\( p_2 \\) включительно, а радиальной — до
коэффициента \\( k_3 \\) или \\( k_6\\) включительно. 

> Таким образом, радиальная составляющая в тангенциальной дисторсии практически всегда опускается.

{{< figure src="https://ylianova.ru/800/600/http/makal47.ru/wp-content/uploads/2013/04/Distorsiya.jpg" class="figure__image" >}}

### Матрица проекции камеры

**Матрица камеры (проекционная матрица)** представляет собой матрицу (3x4), которая описывает отображение камеры-обскуры из трехмерных точек мира в двухмерные точки изображения.

#### Вывод матрицы

{{< figure src="/images/uploads/matrix1.jpg" class="figure__image" >}}

{{< figure src="/images/uploads/matrix2.jpg" class="figure__image" >}}
