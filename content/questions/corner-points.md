---
filename: "corner-points.md"
title: "Угловые точки"
Summary: >
  Позиции угловых точек и их количество являются важными характеристиками изображения.
  Часто используются в 3D, в калибрации, в задаче поиска объекта и в задаче слежения за объектом.
date: 2022-01-08T21:29:03+03:00
билеты: ["Билет 7", ]
draft: false
weight: 11
cover:
  image: https://summervisionproject.com/wp-content/uploads/2020/08/building_kps.jpg
author: "Ilya Kochankov"
---

## Как используются угловые точки?

Позиции **угловых точек** и их количество являются важными характеристиками изображения. 
Часто используются в 3D, в калибрации, в задаче поиска объекта и в задаче слежения за объектом.

## Детектор Moravec

Работа в исследовании привязки изображений с использованием особых точек началась детектора Моравеца (Moravec, 1977). 
Детектор Моравеца – самый простой из существующих. 

Автор рассматривает изменение яркости квадратного окна W 
(обычно размера 3х3, 5х5, 7х7 пикселей) относительно интересующей точки при сдвиге окна W на 1 пиксель в 8-ми 
направлениях (горизонтальных, вертикальных и диагональных). 

### Алгоритм

1) Для каждого пикселя (x,y) в изображении вычислить изменение интенсивности

{{< figure src="https://habrastorage.org/r/w1560/files/77c/edb/b9f/77cedbb9fc124704865a4bd69f984b9d.png"
class="figure__image" >}}
{{< figure src="https://habrastorage.org/r/w1560/files/dab/018/c16/dab018c16dc94b6d8b3dbcade5107d3a.png"
class="figure__image" >}}

2) Построить карту вероятности нахождения углов в каждом пикселе (x,y) изображения посредством вычисления оценочной 
функции. То есть определяется направление, которому соответствует наименьшее изменение интенсивности, 
т.к. угол должен иметь смежные ребра.

3) Отсечь пиксели, в которых значения C(x,y) ниже порогового значения T.

4) Удалить повторяющиеся углы с помощью применения процедуры поиска локальных максимумов функции
отклика (non-maximal suppression). Все полученные ненулевые элементы карты соответствуют углам на изображении.

{{< figure src="/images/uploads/moravec-detector.png"
class="figure__image" >}}

> Основными недостатками рассматриваемого детектора являются отсутствие инвариантности к 
> преобразованию типа "поворот" и возникновение ошибок детектирования при наличии большого количества диагональных ребер.

> Очевидно, что детектор Моравеца обладает свойством анизотропии в 8 принципиальных направлениях смещения окна.

## Детектор Harris

Как показали исследования, наиболее оптимальным детектором L-связных углов является широко известный детектор
Харриса (также его называют оператором Плессея, детектором Харриса и Стефенса).

Харрис и Стефенс улучшили детектор Моравеца (Moravec), введя анизотропию по всем направлениям, 
т.е. рассматривают производные яркости изображения для исследования изменений яркости по множеству направлений. 
Они вводят в рассмотрение производные по некоторым принципиальным направлениям.

### Разработка алгоритма

Без потери общности мы будем предполагать, что используется двухмерное изображение в градациях серого. 
Пусть это изображение будет задано как \\( I \\). 

Возьмем фрагмент изображения \\( (x, y) \in W \\)(окно) и сдвинем его на \\( (\Delta x, \Delta y) \\). 

Сумма квадратов разностей (SSD) между этими двумя патчами, обозначенная \\( f \\), определяется как:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/94b3fd497ecd5170c4f1c92714a6eca52ea7ddfc"
class="figure__image" >}}

\\( I(x + \Delta x, y + \Delta y) \\) может быть приблизительно выражено через ряд Тейлора функции 2-х переменных.
Пусть \\( I_x\\) и \\( I_y \\) - частные производные \\( I \\). Тогда при разложении в ряд получаем:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/4541aeb40a80caf4ebf805d11c1d7efc1fffd7d4"
class="figure__image" >}}

Подставляя в исходную сумму квадратов, получаем приближение:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/6f4bb84a9f3e30eceec6f89b0ed8ba1990400570"
class="figure__image" >}}

которое может быть записан в матричной форме:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e884b4ad4ae58ecfcdfea77f9a5c2ca7c5420119"
class="figure__image" >}}

где \\( M \\) - структурный тензор (автокорреляционная матрица)

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/a617dda21e306dbfbdb7a186b1c203e3f3443867"
class="figure__image" >}}

### Алгоритм

Обычно алгоритм обнаружения углов Харриса можно разделить на пять шагов.

1. От цвета к оттенкам серого

Если мы используем детектор углов Харриса в цветном изображении, первым шагом будет преобразование его в изображение 
в градациях серого, что повысит скорость обработки.

Значение пикселя серой шкалы можно вычислить как взвешенную сумму значений R, B и G цветного изображения:

{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/8e5b4cc086876f43b04814738e17004175661c8e"
class="figure__image" >}}
{{< figure src="https://wikimedia.org/api/rest_v1/media/math/render/svg/b11f454246d45dc1dc7b0dc5833bce07ee596646"
class="figure__image" >}}

2. Расчет пространственной производной

Далее мы собираемся вычислить \\( I_x(x, y) \\) и \\( I_y(x, y)\\).

3. Настройка тензора структуры

С \\( I_x(x, y) \\), \\( I_y(x, y)\\), мы можем построить тензор структуры \\( M\\).

4. Расчет отклика Харриса

Угол характеризуется большим изменением \\( f(\Delta x, \Delta y) \\) во всех направлениях. 

На основе анализа собственных значений A, эта характеристика может быть выражена следующим образом: 
должно быть два "больших" собственных значения для точечных особенностей. На основании величины собственных значений, 
можно сделать следующие выводы на основе этих аргументов:

  - Если \\( \lambda_1 \approx 0 \\) и \\( \lambda_2 \approx 0 \\) то этот пиксель (х, у) не имеет особенности, 
представляющей интерес.

  - Если \\( \lambda_1 \approx 0 \\) и \\( \lambda_2\\) имеет большое положительное значение, то найден край
  - Если \\( \lambda_1\\) и \\( \lambda_2\\) большие положительные значения, то найден угол

{{< figure src="https://habrastorage.org/r/w1560/files/487/859/f3d/487859f3d0e6455cb2b62baad30220c1.png"
class="figure__image" >}}

> Вместо подсчёта \\( λ_i \\) быстрее посчитать 
> {{< figure src="/images/uploads/harris-detector.png"
class="figure__image" >}}

5. Немаксимальное подавление


